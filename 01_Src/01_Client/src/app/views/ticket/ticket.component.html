<!--
* @Author                : AdrienLanco0<adrienlanco0@gmail.com>
* @CreatedDate           : 2023-03-17 16:48:00
* @LastEditors           : AdrienLanco0<adrienlanco0@gmail.com>
* @LastEditDate          : 2023-03-27 16:35:03
-->

<div id="ticket">
  <div class="ticket">
    <div class="main">
      <header>
        <h1 edtTxt [isEdit]="onEdit" [(value)]="ticket.name"></h1>
        <h2 edtTxt [isEdit]="onEdit" [(value)]="ticket.description"></h2>

        <app-button id="editTicket" type="scnd" size="md" label="Edit Ticket" *ngIf="!onEdit" (click)="redirectToEdit()" />
        <app-button id="saveTicket" type="scnd" size="md" label="Save Ticket" *ngIf="onEdit" (click)='saveTicket()' />
        <app-button id="deleteTicket" type="scnd" size="md" label="Delete Ticket" *ngIf="onEdit" (click)='command.deleteTicket(ticket)' />
      </header>
      <div class="advancement">
        <app-progress-bar id="test" [value]="15" />
      </div>
      <app-comments-section targetType="tickets" [targetId]="ticket.id" [comments]="ticket.comments" />
    </div>
    <aside>
      <div class="details">
        <h3>Details</h3>
        <div class="container">
          <h4>Assignee</h4>
          <div class="text">
            <app-avatar  id="randy" />
            Randy Gouse
          </div>
        </div>
        <div class="container">
          <h4>Owner</h4>
          <div class="text">
            <app-avatar id="madelyn" />
            {{ ticket.owner ? ticket.owner.name : "" }}
          </div>
        </div>
        <div class="container">
          <h4>Version</h4>
          <app-versions-section [isEdit]="true" [version]="getTicketVersion()"
            (versionChange)="changeTicketVersion($event)" />
        </div>
        <div class="container">
          <h4>Status</h4>
          <div class="text">
            <app-status-labeled [isEdit]="true" [(status)]="ticket.status" (statusChange)="command.editTicket(this.ticket)"/>
          </div>
        </div>
        <div class="container">
          <h4>Level</h4>
          <div class="text">
            <app-level-section [(level)]="ticket.level" (levelChange)="command.editTicket(this.ticket)"/>
          </div>
        </div>
        <div class="container">
          <h4>Created</h4>
          <div class="text">{{ ticket.created }}</div>
        </div>
      </div>
      <div class="activity">
        <h3>Last activity</h3>
        <div class="content" *ngFor="let item of activity">
          <div class="img"><app-avatar [id]="item.name" /></div>
          <div class="name">{{ item.name }}</div>
          <div class="desc">{{ item.action }} <a [href]="item.url">{{ item.id }}</a>, {{ item.time }} ago</div>
        </div>
      </div>
    </aside>
  </div>
</div>
