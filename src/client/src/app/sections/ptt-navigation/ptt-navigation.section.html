<!--
* @Author                : 0K00<qdouvillez@gmail.com>
* @CreatedDate           : 2023-09-20 16:09:00
* @LastEditors           : 0K00<qdouvillez@gmail.com>
* @LastEditDate          : 2023-11-22 15:29:05
-->

<div class="section-ptt-navigation">
  <ul>
    <li [ngClass]="{'item': true, 'depth': !hasChild(tasks, {projectId: project.id})}"
        *ngFor="let project of projects">
      <div class="head">
        <div  class="collapse"
              *ngIf="hasChild(tasks, {projectId: project.id})"
              (click)="toggleCollapse(project.id)">
          <core-icon [ngStyle]="{'transform': 'translateY(-1px)'}" [icon]="isOpen(project.id) ? 'chevron-down' : 'chevron-right'"></core-icon>
        </div>

        <a [tooltip]="project.name" routerLink="/projects/{{project.id}}" routerLinkActive="active" class="link">
          <core-icon [icon]="project.status"></core-icon>
          <div class="ellipsis">{{project.name}}</div>
        </a>
      </div>

      <ul *ngIf="isOpen(project.id)" class="child">
        <li [ngClass]="{'item': true, 'depth': !hasChild(tickets, {taskId: task.id})}"
            *ngFor="let task of _.filter(tasks, {projectId: project.id})">
          <div class="head">
            <div  class="collapse"
                  *ngIf="hasChild(tickets, {taskId: task.id})"
                  (click)="toggleCollapse(task.id)">
              <core-icon [icon]="isOpen(task.id) ? 'chevron-down' : 'chevron-right'"></core-icon>
            </div>

            <a routerLink="/tasks/{{task.id}}" routerLinkActive="active" class="link">
              <core-icon [icon]="task.status"></core-icon>
              <div [tooltip]="task.name" class="ellipsis">{{task.name}}</div>
            </a>
          </div>

          <ul *ngIf="isOpen(task.id)" class="child">
            <li class="item depth"
                *ngFor="let ticket of _.filter(tickets, {taskId: task.id})">
              <div class="head">
                <a routerLink="tickets/{{ticket.id}}" routerLinkActive="active" class="link">
                  <core-icon [icon]="ticket.status"></core-icon>
                  <div [tooltip]="ticket.name" class="ellipsis">{{ticket.name}}</div>
                </a>
              </div>
            </li>
          </ul>
        </li>
      </ul>
    </li>
  </ul>
</div>
