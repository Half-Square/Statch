<!--
* @Author                : 0K00<qdouvillez@gmail.com>
* @CreatedDate           : 2023-09-21 13:14:00
* @LastEditors           : 0K00<qdouvillez@gmail.com>
* @LastEditDate          : 2023-09-29 17:54:00
-->

<div class="ptt">
  <div class="bar">
    <core-button *ngIf="type != 'tickets'" (click)="newItem()" [type]="'basic'" [style]="'default'" [size]="'medium'" ><core-icon icon="plus"></core-icon></core-button>
    <core-button (click)="assigneeUser(user.getUser(), true)" [type]="isAssignee ? 'flat' : 'basic'" [style]="'primary'" [size]="'medium'"><core-icon [icon]="isAssignee ? 'heart--fill' : 'heart'"></core-icon></core-button>
  </div>

  <div class="container">
    <div class="main">
      <div class="header">
        <section-ptt-header
          *ngIf="_.find(type == 'tickets' ? tickets : (type == 'projects' ? projects : tasks), {id: id})"
          [editTitle]="onEdit"
          [editDescription]="onEdit"
          (callback)="headerSave($event)"
          [title]="_.find(type == 'tickets' ? tickets : (type == 'projects' ? projects : tasks), {id: id}).name"
          [description]="_.find(type == 'tickets' ? tickets : (type == 'projects' ? projects : tasks), {id: id}).description">
        </section-ptt-header>
      </div>

      <div *ngIf="type != 'tickets'" class="advancement">

        <section-ptt-advancement [value]="progressValue"></section-ptt-advancement>

        <section-ptt-list
          [elements]="_.filter(type === 'projects' ? printTasks : printTickets, type === 'projects' ? {projectId: id} : {taskId: id})"
          [type]="typeChild">

          <div sort>
            {{type === "projects" ? "Tasks" : "Tickets"}}
            <component-select
              *ngIf="type === 'projects' ? _.find(versions, {projectId: id}) :
                    _.find(tasks, {id: id}) &&
                    _.find(tasks, {id: id}).projectId &&
                    _.find(versions, {projectId: _.find(tasks, {id: id}).projectId})"

              [data]="_.filter(versions, {projectId: type === 'projects' ? id : _.find(tasks, {id: id}).projectId})"
              [placeholder]="'Select verions to sort...'"
              [multi]="true"
              [hasSearch]="false"
              (callback)="sortElement($event)">
            </component-select>
          </div>

          <div class="add" add>
            <core-icon icon="plus"></core-icon>
            Create new {{type === "projects" ? "task" : "ticket"}}
          </div>

        </section-ptt-list>
      </div>

      <div class="comment">
        <section-ptt-comment (callback)="commentPublish($event)" [comments]="comments"></section-ptt-comment>
      </div>
    </div>

    <aside class="aside">
      <div class="details">
        <section-ptt-details
          [id]="id"
          [type]="type"
          [owner]="currentElement.ownerId"
          [assignee]="currentElement.assignments"
          (cbAssignee)="assigneeUser($event, false)"
          [versionTitle]="type === 'projects' ? 'Version' : 'Target version'"
          [versions]="versions"
          [status]="[{id:'new', status: 'new'}, {id:'progress', status: 'progress'}, {id:'done', status: 'done'}, {id:'reject', status: 'reject'}, {id:'wait', status: 'wait'}]"
          (cbStatus)="changeStatus($event)"
          [currentStatus]="[{id: currentElement.status, status: currentElement.status}]"
          [currentLabels]="currentElement.labels"
          (cbLabels)="changeLabels($event)"
          [levels]="[{id: 'low', level:'low'}, {id: 'normal', level:'normal'}, {id: 'moderate', level:'moderate'}, {id: 'high', level:'high'}]"
          (cbLevel)="changeLevel($event)"
          [currentLevel]="[{id: currentElement.level, level: currentElement.level}]"
          [listTitle]="type === 'projects' ? 'tasks' : 'tickets'"
          [nbList]="_.filter(type === 'projects' ? printTasks : printTickets, type === 'projects' ? {projectId: id} : {taskId: id}).length"
          [created]="currentElement.created"
        ></section-ptt-details>
      </div>
    </aside>
  </div>


</div>
